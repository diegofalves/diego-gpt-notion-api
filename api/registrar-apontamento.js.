export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method Not Allowed" });
  }

  const {
    tarefa,
    projeto,
    cliente,
    data,
    duracao,
    status,
    observacoes
  } = req.body;

  const notion = require('@notionhq/client').Client;
  const notionClient = new notion({
    auth: process.env.NOTION_SECRET,
  });

  try {
    const response = await notionClient.pages.create({
      parent: {
        database_id: process.env.DATABASE_ID,
      },
      properties: {
        Tarefa: { title: [{ text: { content: tarefa } }] },
        Projeto: { rich_text: [{ text: { content: projeto } }] },
        Cliente: { rich_text: [{ text: { content: cliente } }] },
        Data: { date: { start: data } },
        Duração: { number: duracao },
        Status: { select: { name: status } },
        Observações: { rich_text: [{ text: { content: observacoes || "" } }] },
      },
    });

    res.status(200).json({ message: "Apontamento registrado com sucesso", response });
  } catch (error) {
    console.error("Erro ao registrar apontamento:", error.body || error.message);
    res.status(500).json({ error: "Erro ao registrar apontamento no Notion", details: error.body || error.message });
  }
}
